import{R as S,C as T}from"./CheckBox-Bah-34Fm.js";import{_ as h,o as r,c as a,h as p,v as m,a as n,F as _,j as x,t as v,i as u,b as g,k as D,l as k,r as c}from"./index-NFo_HsSF.js";const O={data(){return{isOpen:!1,search:"",selected:null,templates:[]}},computed:{filteredItems(){return this.templates.filter(t=>t.name.toLowerCase().includes(this.search.toLowerCase()))}},mounted(){this.getallTemplates()},methods:{selectItem(t){this.selected=t,this.search=t.name,this.isOpen=!1,this.$emit("template-selected",t)},closeDropdown(){setTimeout(()=>{this.isOpen=!1},150)},async getallTemplates(){try{const e=await(await fetch("https://web-i3-back.fly.dev/admin/templates",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();this.templates=e,console.log(e)}catch(t){console.error(t)}}}},q={class:"relative w-64"},B={key:0,class:"absolute z-10 w-full mt-1 bg-white border rounded-md shadow-sm px-4 py-2 text-gray-700"},E={class:"max-h-48 overflow-y-auto"},N=["onClick"],M={key:0,class:"px-4 py-2 text-gray-500"};function $(t,e,d,y,l,s){return r(),a("div",q,[p(n("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>l.search=o),onFocus:e[1]||(e[1]=o=>l.isOpen=!0),onBlur:e[2]||(e[2]=(...o)=>s.closeDropdown&&s.closeDropdown(...o)),placeholder:"Rechercher ou sélectionner...",class:"w-full px-4 py-2 border rounded shadow focus:outline-none"},null,544),[[m,l.search]]),l.isOpen?(r(),a("div",B,[n("ul",E,[(r(!0),a(_,null,x(s.filteredItems,o=>(r(),a("li",{key:o.survey_templateID,onClick:f=>s.selectItem(o),class:"px-4 py-2 cursor-pointer hover:bg-gray-100"},v(o.name),9,N))),128)),s.filteredItems.length===0?(r(),a("li",M," Aucun résultat trouvé ")):u("",!0)])])):u("",!0)])}const j=h(O,[["render",$]]),V={data(){return{isOpen:!1,search:"",selected:null,modules:[]}},computed:{filteredItems(){return this.modules.filter(t=>t.name.toLowerCase().includes(this.search.toLowerCase()))}},mounted(){this.getallModules()},methods:{selectItem(t){this.selected=t,this.search=t.name,this.isOpen=!1,this.$emit("module-selected",t)},closeDropdown(){setTimeout(()=>{this.isOpen=!1},150)},async getallModules(){try{const e=await(await fetch("https://web-i3-back.fly.dev/admin/modules",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();e.forEach(d=>{d.name=this.createModuleName(d)}),this.modules=e,console.log(e)}catch(t){console.error(t)}},createModuleName(t){return`${t.subject}-${t.group}-${t.teacher_lastname}`}}},U={class:"relative w-64"},F={key:0,class:"absolute z-10 w-full mt-1 bg-white border rounded-md shadow-sm px-4 py-2 text-gray-700"},R={class:"max-h-48 overflow-y-auto"},J=["onClick"],Q={key:0,class:"px-4 py-2 text-gray-500"};function A(t,e,d,y,l,s){return r(),a("div",U,[p(n("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>l.search=o),onFocus:e[1]||(e[1]=o=>l.isOpen=!0),onBlur:e[2]||(e[2]=(...o)=>s.closeDropdown&&s.closeDropdown(...o)),placeholder:"Rechercher ou sélectionner...",class:"w-full px-4 py-2 border rounded shadow focus:outline-none"},null,544),[[m,l.search]]),l.isOpen?(r(),a("div",F,[n("ul",R,[(r(!0),a(_,null,x(s.filteredItems,o=>(r(),a("li",{key:o.moduleID,onClick:f=>s.selectItem(o),class:"px-4 py-2 cursor-pointer hover:bg-gray-100"},v(o.subject+"-"+o.group+"-"+o.teacher_lastname),9,J))),128)),s.filteredItems.length===0?(r(),a("li",Q," Aucun résultat trouvé ")):u("",!0)])])):u("",!0)])}const L=h(V,[["render",A]]),z={data(){return{modified:!1,isEditable:!0,questionsTemplateNotModified:[],templateID:null,moduleID:null,questions:[],errors:{},templateName:""}},components:{RadioButton:S,CheckBox:T,searchBarTemplate:j,searchBarModule:L},methods:{modifyForm(){this.isEditable=!this.isEditable},addQuestion(){this.questions.push({question_text:"",question_type:"text",options:[]}),console.log(this.questions)},updateOptions(t,e){t.options=e},validateFields(){this.errors={};let t=!0;return this.questions.forEach(e=>{e.question_type==="text"&&!e.question_text.trim()&&(this.errors[`question_${e.id}`]="Question text is required.",t=!1)}),t},handleTemplateSelected(t){this.isEditable=!1,this.templateID=t.survey_templateID,console.log(t.name,t.survey_templateID),this.getTemplate(t.survey_templateID)},handleModuleSelected(t){console.log(t),this.moduleID=t.moduleID},async getTemplate(t){try{(await fetch(`https://web-i3-back.fly.dev/admin/templates/${t}`)).json().then(d=>{console.log(d),this.questions=d.questions,this.questionsTemplateNotModified=JSON.parse(JSON.stringify(d.questions))})}catch(e){console.error(e)}},async submitSurvey(){this.validateFields()&&(console.log(this.questions),console.log(this.questionsTemplateNotModified),JSON.stringify(this.questionsTemplateNotModified)===JSON.stringify(this.questions)?(console.log("No changes"),console.log(this.moduleID),console.log(this.templateID),(await fetch("https://web-i3-back.fly.dev/admin/createfromtemplate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({survey_templateID:this.templateID,moduleID:this.moduleID})})).json().then(e=>{console.log(e)})):(console.log("Changes detected"),console.log(this.questions),(await fetch("https://web-i3-back.fly.dev/admin/createfromnothing",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.templateName,questions:this.questions,moduleID:this.moduleID})})).json().then(e=>{console.log(e)})))}}},P={class:"mb-6"},G={class:"flex justify-between items-center"},H={key:0},K={class:"block text-sm font-medium text-gray-700 mb-2"},W=["onUpdate:modelValue","disabled"],X=["onUpdate:modelValue","disabled"],Y={key:0};function Z(t,e,d,y,l,s){const o=c("searchBarTemplate"),f=c("searchBarModule"),C=c("RadioButton"),I=c("CheckBox");return r(),a("form",null,[n("div",P,[n("div",G,[g(o,{class:"py-2",onTemplateSelected:s.handleTemplateSelected},null,8,["onTemplateSelected"]),g(f,{class:"py-2",onModuleSelected:s.handleModuleSelected},null,8,["onModuleSelected"]),n("button",{onClick:e[0]||(e[0]=(...i)=>s.modifyForm&&s.modifyForm(...i)),class:"ml-4 py-2 px-4 bg-primary font-semibold text-white rounded-md shadow-md hover:bg-primary-hover transition duration-300"}," Modify Form ")]),l.isEditable?(r(),a("div",H,[p(n("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=i=>l.templateName=i),class:"block w-full px-4 py-2 border rounded-md shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 mt-4",placeholder:"Enter Template name"},null,512),[[m,l.templateName]])])):u("",!0)]),(r(!0),a(_,null,x(l.questions,(i,w)=>(r(),a("div",{key:w,class:"mb-4 p-4 border-2 border-dashed border-transparent-hover rounded-lg"},[n("label",K,"Question "+v(w+1),1),n("div",null,[p(n("input",{type:"text","onUpdate:modelValue":b=>i.question_text=b,disabled:!l.isEditable,class:"block w-full px-4 py-2 border rounded-md shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-2",placeholder:"Enter question"},null,8,W),[[m,i.question_text]])]),e[5]||(e[5]=n("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Response Type",-1)),p(n("select",{"onUpdate:modelValue":b=>i.question_type=b,disabled:!l.isEditable,class:"block w-full px-4 py-2 border rounded-md shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"},e[4]||(e[4]=[n("option",{value:"text"},"Text Input",-1),n("option",{value:"score"},"Star Rating (1-5)",-1),n("option",{value:"radio"},"Radio Buttons",-1),n("option",{value:"checkbox"},"Checkbox",-1)]),8,X),[[D,i.question_type]]),i.question_type==="radio"?(r(),k(C,{key:0,question:i,isEditable:l.isEditable,onUpdateOptions:s.updateOptions},null,8,["question","isEditable","onUpdateOptions"])):u("",!0),i.question_type==="checkbox"?(r(),k(I,{key:1,question:i,isEditable:l.isEditable,onUpdateOptions:s.updateOptions},null,8,["question","isEditable","onUpdateOptions"])):u("",!0)]))),128)),l.isEditable?(r(),a("div",Y,[n("button",{onClick:e[2]||(e[2]=(...i)=>s.addQuestion&&s.addQuestion(...i)),class:"w-full py-2 px-4 bg-primary font-semibold text-[white] rounded-md shadow-md hover:bg-primary-hover transition duration-300"}," Add Question ")])):u("",!0),n("button",{onClick:e[3]||(e[3]=(...i)=>s.submitSurvey&&s.submitSurvey(...i)),class:"mt-4 w-full py-2 px-4 bg-transparent font-semibold text-[primary] rounded-md shadow-md hover:bg-transparent-hover transition duration-300"}," Publish Survey ")])}const ee=h(z,[["render",Z]]),te={components:{CreateSurveyComponent:ee}},se={class:"min-h-screen p-8 flex justify-center items-start"},oe={class:"bg-white shadow-md rounded-lg p-6 w-full max-w-3xl"};function ne(t,e,d,y,l,s){const o=c("CreateSurveyComponent");return r(),a("div",se,[n("div",oe,[e[0]||(e[0]=n("h1",{class:"text-2xl font-semibold text-[primary] mb-4"},"Create Survey",-1)),g(o)])])}const ie=h(te,[["render",ne]]);export{ie as default};
