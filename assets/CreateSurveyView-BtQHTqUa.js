import{R as O,C as S}from"./CheckBox-CWsjGWEo.js";import{_ as f,o as r,c as i,h as p,v as h,a as o,F as _,j as x,t as w,i as u,b as g,k as T,l as k,r as c}from"./index-DL6KsKLM.js";const E={data(){return{isOpen:!1,search:"",selected:null,templates:[]}},computed:{filteredItems(){return this.templates.filter(t=>t.name.toLowerCase().includes(this.search.toLowerCase()))}},mounted(){this.getallTemplates(),document.addEventListener("mousedown",this.handleClickOutside)},beforeUnmount(){document.removeEventListener("mousedown",this.handleClickOutside)},methods:{selectItem(t){this.selected=t,this.search=t.name,this.isOpen=!1,this.$emit("template-selected",t)},handleClickOutside(t){const e=this.$refs.dropdown;e&&!e.contains(t.target)&&(this.isOpen=!1)},async getallTemplates(){try{const e=await(await fetch("https://web-i3-back.fly.dev/admin/templates",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();this.templates=e}catch(t){console.error(t)}}}},q={class:"relative w-64",ref:"dropdown"},D={key:0,class:"absolute z-10 w-full mt-1 bg-white border rounded-md shadow-sm px-4 py-2 text-gray-700"},N={class:"max-h-48 overflow-y-auto"},$=["onClick"],B={key:0,class:"px-4 py-2 text-gray-500"};function M(t,e,d,y,s,l){return r(),i("div",q,[p(o("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=n=>s.search=n),onFocus:e[1]||(e[1]=n=>s.isOpen=!0),onInput:e[2]||(e[2]=n=>s.isOpen=!0),placeholder:"Rechercher ou sélectionner...",class:"w-full px-4 py-2 border rounded shadow focus:outline-none"},null,544),[[h,s.search]]),s.isOpen?(r(),i("div",D,[o("ul",N,[(r(!0),i(_,null,x(l.filteredItems,n=>(r(),i("li",{key:n.survey_templateID,onClick:b=>l.selectItem(n),class:"px-4 py-2 cursor-pointer hover:bg-gray-100"},w(n.name),9,$))),128)),l.filteredItems.length===0?(r(),i("li",B," Aucun résultat trouvé ")):u("",!0)])])):u("",!0)],512)}const j=f(E,[["render",M]]),U={data(){return{isOpen:!1,search:"",selected:null,modules:[]}},computed:{filteredItems(){return this.modules.filter(t=>t.name.toLowerCase().includes(this.search.toLowerCase()))}},mounted(){this.getallModules(),document.addEventListener("mousedown",this.handleClickOutside)},beforeUnmount(){document.removeEventListener("mousedown",this.handleClickOutside)},methods:{selectItem(t){this.selected=t,this.search=t.name,this.isOpen=!1,this.$emit("module-selected",t)},handleClickOutside(t){const e=this.$refs.dropdown;e&&!e.contains(t.target)&&(this.isOpen=!1)},async getallModules(){try{const e=await(await fetch("https://web-i3-back.fly.dev/admin/modules",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();e.forEach(d=>{d.name=this.createModuleName(d)}),this.modules=e}catch(t){console.error(t)}},createModuleName(t){return`${t.subject}-${t.group}-${t.teacher_lastname}`}}},V={class:"relative w-64",ref:"dropdown"},F={key:0,class:"absolute z-10 w-full mt-1 bg-white border rounded-md shadow-sm px-4 py-2 text-gray-700"},R={class:"max-h-48 overflow-y-auto"},L=["onClick"],Q={key:0,class:"px-4 py-2 text-gray-500"};function J(t,e,d,y,s,l){return r(),i("div",V,[p(o("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=n=>s.search=n),onFocus:e[1]||(e[1]=n=>s.isOpen=!0),onInput:e[2]||(e[2]=n=>s.isOpen=!0),placeholder:"Rechercher ou sélectionner...",class:"w-full px-4 py-2 border rounded shadow focus:outline-none"},null,544),[[h,s.search]]),s.isOpen?(r(),i("div",F,[o("ul",R,[(r(!0),i(_,null,x(l.filteredItems,n=>(r(),i("li",{key:n.moduleID,onClick:b=>l.selectItem(n),class:"px-4 py-2 cursor-pointer hover:bg-gray-100"},w(n.subject+"-"+n.group+"-"+n.teacher_lastname),9,L))),128)),l.filteredItems.length===0?(r(),i("li",Q," Aucun résultat trouvé ")):u("",!0)])])):u("",!0)],512)}const A=f(U,[["render",J]]),z={data(){return{modified:!1,isEditable:!0,questionsTemplateNotModified:[],templateID:null,moduleID:null,questions:[],errors:{},templateName:""}},components:{RadioButton:O,CheckBox:S,searchBarTemplate:j,searchBarModule:A},methods:{modifyForm(){this.isEditable=!this.isEditable},addQuestion(){this.questions.push({question_text:"",question_type:"text",options:[]}),console.log(this.questions)},removeQuestion(t){this.questions.splice(t,1)},updateOptions(t,e){t.options=e},validateFields(){this.errors={};let t=!0;return this.questions.forEach(e=>{e.question_type==="text"&&!e.question_text.trim()&&(this.errors[`question_${e.id}`]="Question text is required.",t=!1)}),t},handleTemplateSelected(t){this.isEditable=!1,this.templateID=t.survey_templateID,console.log(t.name,t.survey_templateID),this.getTemplate(t.survey_templateID)},handleModuleSelected(t){console.log(t),this.moduleID=t.moduleID},async getTemplate(t){try{(await fetch(`https://web-i3-back.fly.dev/admin/templates/${t}`)).json().then(d=>{console.log(d),this.questions=d.questions,this.questionsTemplateNotModified=JSON.parse(JSON.stringify(d.questions))})}catch(e){console.error(e)}},async submitSurvey(){this.validateFields()&&(console.log(this.questions),console.log(this.questionsTemplateNotModified),JSON.stringify(this.questionsTemplateNotModified)===JSON.stringify(this.questions)?(console.log("No changes"),console.log(this.moduleID),console.log(this.templateID),(await fetch("https://web-i3-back.fly.dev/admin/createfromtemplate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({survey_templateID:this.templateID,moduleID:this.moduleID})})).json().then(e=>{console.log(e)})):(console.log("Changes detected"),console.log(this.questions),(await fetch("https://web-i3-back.fly.dev/admin/createfromnothing",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.templateName,questions:this.questions,moduleID:this.moduleID})})).json().then(e=>{console.log(e)})))}}},P={class:"mb-6"},G={class:"flex justify-between items-center"},H={key:0},K={class:"flex justify-between items-center mb-2"},W={class:"block text-sm font-medium text-gray-700"},X=["onClick"],Y=["onUpdate:modelValue","disabled"],Z=["onUpdate:modelValue","disabled"],ee={key:0};function te(t,e,d,y,s,l){const n=c("searchBarTemplate"),b=c("searchBarModule"),C=c("RadioButton"),I=c("CheckBox");return r(),i("form",null,[o("div",P,[o("div",G,[g(n,{class:"py-2",onTemplateSelected:l.handleTemplateSelected},null,8,["onTemplateSelected"]),g(b,{class:"py-2",onModuleSelected:l.handleModuleSelected},null,8,["onModuleSelected"]),o("button",{onClick:e[0]||(e[0]=(...a)=>l.modifyForm&&l.modifyForm(...a)),class:"ml-4 py-2 px-4 bg-primary font-semibold text-white rounded-md shadow-md hover:bg-primary-hover transition duration-300"}," Modify Form ")]),s.isEditable?(r(),i("div",H,[p(o("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=a=>s.templateName=a),class:"block w-full px-4 py-2 border rounded-md shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 mt-4",placeholder:"Enter Template name"},null,512),[[h,s.templateName]])])):u("",!0)]),(r(!0),i(_,null,x(s.questions,(a,v)=>(r(),i("div",{key:v,class:"mb-4 p-4 border-2 border-dashed border-transparent-hover rounded-lg"},[o("div",K,[o("label",W,"Question "+w(v+1),1),s.isEditable?(r(),i("button",{key:0,onClick:m=>l.removeQuestion(v),class:"text-red-400 hover:text-red-500 transition duration-300"}," Remove ",8,X)):u("",!0)]),o("div",null,[p(o("input",{type:"text","onUpdate:modelValue":m=>a.question_text=m,disabled:!s.isEditable,class:"block w-full px-4 py-2 border rounded-md shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-2",placeholder:"Enter question"},null,8,Y),[[h,a.question_text]])]),e[5]||(e[5]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Response Type",-1)),p(o("select",{"onUpdate:modelValue":m=>a.question_type=m,disabled:!s.isEditable,class:"block w-full px-4 py-2 border rounded-md shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"},e[4]||(e[4]=[o("option",{value:"text"},"Text Input",-1),o("option",{value:"score"},"Star Rating (1-5)",-1),o("option",{value:"radio"},"Radio Buttons",-1),o("option",{value:"checkbox"},"Checkbox",-1)]),8,Z),[[T,a.question_type]]),a.question_type==="radio"?(r(),k(C,{key:0,question:a,isEditable:s.isEditable,onUpdateOptions:l.updateOptions},null,8,["question","isEditable","onUpdateOptions"])):u("",!0),a.question_type==="checkbox"?(r(),k(I,{key:1,question:a,isEditable:s.isEditable,onUpdateOptions:l.updateOptions},null,8,["question","isEditable","onUpdateOptions"])):u("",!0)]))),128)),s.isEditable?(r(),i("div",ee,[o("button",{onClick:e[2]||(e[2]=(...a)=>l.addQuestion&&l.addQuestion(...a)),class:"w-full py-2 px-4 bg-primary font-semibold text-[white] rounded-md shadow-md hover:bg-primary-hover transition duration-300"}," Add Question ")])):u("",!0),o("button",{onClick:e[3]||(e[3]=(...a)=>l.submitSurvey&&l.submitSurvey(...a)),class:"mt-4 w-full py-2 px-4 bg-transparent font-semibold text-[primary] rounded-md shadow-md hover:bg-transparent-hover transition duration-300"}," Publish Survey ")])}const se=f(z,[["render",te]]),oe={components:{CreateSurveyComponent:se}},ne={class:"p-8 flex justify-center items-start"},le={class:"bg-white shadow-md rounded-lg p-6 w-full max-w-3xl"};function re(t,e,d,y,s,l){const n=c("CreateSurveyComponent");return r(),i("div",ne,[o("div",le,[e[0]||(e[0]=o("h1",{class:"text-2xl font-semibold text-[primary] mb-4"},"Create Survey",-1)),g(n)])])}const de=f(oe,[["render",re]]);export{de as default};
