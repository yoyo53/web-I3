import{R as S,C as T}from"./CheckBox-ZRa5cCiG.js";import{_ as y,o as r,c as i,h as p,v as h,a as n,F as v,j as x,t as w,i as u,b as _,k as D,l as k,r as c}from"./index-BgZADlb_.js";const O={data(){return{isOpen:!1,search:"",selected:null,templates:[]}},computed:{filteredItems(){return this.templates.filter(t=>t.name.toLowerCase().includes(this.search.toLowerCase()))}},mounted(){this.getallTemplates()},methods:{selectItem(t){this.selected=t,this.search=t.name,this.isOpen=!1,this.$emit("template-selected",t)},closeDropdown(){setTimeout(()=>{this.isOpen=!1},150)},async getallTemplates(){try{const e=await(await fetch("https://web-i3-back.fly.dev/admin/templates",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();this.templates=e,console.log(e)}catch(t){console.error(t)}}}},q={class:"relative w-64"},E={key:0,class:"absolute z-10 w-full mt-1 bg-white border rounded-md shadow-sm px-4 py-2 text-gray-700"},B={class:"max-h-48 overflow-y-auto"},N=["onClick"],M={key:0,class:"px-4 py-2 text-gray-500"};function j(t,e,d,f,l,s){return r(),i("div",q,[p(n("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>l.search=o),onFocus:e[1]||(e[1]=o=>l.isOpen=!0),onBlur:e[2]||(e[2]=(...o)=>s.closeDropdown&&s.closeDropdown(...o)),placeholder:"Rechercher ou sélectionner...",class:"w-full px-4 py-2 border rounded shadow focus:outline-none"},null,544),[[h,l.search]]),l.isOpen?(r(),i("div",E,[n("ul",B,[(r(!0),i(v,null,x(s.filteredItems,o=>(r(),i("li",{key:o.survey_templateID,onClick:b=>s.selectItem(o),class:"px-4 py-2 cursor-pointer hover:bg-gray-100"},w(o.name),9,N))),128)),s.filteredItems.length===0?(r(),i("li",M," Aucun résultat trouvé ")):u("",!0)])])):u("",!0)])}const $=y(O,[["render",j]]),V={data(){return{isOpen:!1,search:"",selected:null,modules:[]}},computed:{filteredItems(){return this.modules.filter(t=>t.name.toLowerCase().includes(this.search.toLowerCase()))}},mounted(){this.getallModules()},methods:{selectItem(t){this.selected=t,this.search=t.name,this.isOpen=!1,this.$emit("module-selected",t)},closeDropdown(){setTimeout(()=>{this.isOpen=!1},150)},async getallModules(){try{const e=await(await fetch("https://web-i3-back.fly.dev/admin/modules",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();e.forEach(d=>{d.name=this.createModuleName(d)}),this.modules=e,console.log(e)}catch(t){console.error(t)}},createModuleName(t){return`${t.subject}-${t.group}-${t.teacher_lastname}`}}},U={class:"relative w-64"},F={key:0,class:"absolute z-10 w-full mt-1 bg-white border rounded-md shadow-sm px-4 py-2 text-gray-700"},R={class:"max-h-48 overflow-y-auto"},Q=["onClick"],J={key:0,class:"px-4 py-2 text-gray-500"};function A(t,e,d,f,l,s){return r(),i("div",U,[p(n("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>l.search=o),onFocus:e[1]||(e[1]=o=>l.isOpen=!0),onBlur:e[2]||(e[2]=(...o)=>s.closeDropdown&&s.closeDropdown(...o)),placeholder:"Rechercher ou sélectionner...",class:"w-full px-4 py-2 border rounded shadow focus:outline-none"},null,544),[[h,l.search]]),l.isOpen?(r(),i("div",F,[n("ul",R,[(r(!0),i(v,null,x(s.filteredItems,o=>(r(),i("li",{key:o.moduleID,onClick:b=>s.selectItem(o),class:"px-4 py-2 cursor-pointer hover:bg-gray-100"},w(o.subject+"-"+o.group+"-"+o.teacher_lastname),9,Q))),128)),s.filteredItems.length===0?(r(),i("li",J," Aucun résultat trouvé ")):u("",!0)])])):u("",!0)])}const L=y(V,[["render",A]]),z={data(){return{modified:!1,isEditable:!0,questionsTemplateNotModified:[],templateID:null,moduleID:null,questions:[],errors:{},templateName:""}},components:{RadioButton:S,CheckBox:T,searchBarTemplate:$,searchBarModule:L},methods:{modifyForm(){this.isEditable=!this.isEditable},addQuestion(){this.questions.push({question_text:"",question_type:"text",options:[]}),console.log(this.questions)},removeQuestion(t){this.questions.splice(t,1)},updateOptions(t,e){t.options=e},validateFields(){this.errors={};let t=!0;return this.questions.forEach(e=>{e.question_type==="text"&&!e.question_text.trim()&&(this.errors[`question_${e.id}`]="Question text is required.",t=!1)}),t},handleTemplateSelected(t){this.isEditable=!1,this.templateID=t.survey_templateID,console.log(t.name,t.survey_templateID),this.getTemplate(t.survey_templateID)},handleModuleSelected(t){console.log(t),this.moduleID=t.moduleID},async getTemplate(t){try{(await fetch(`https://web-i3-back.fly.dev/admin/templates/${t}`)).json().then(d=>{console.log(d),this.questions=d.questions,this.questionsTemplateNotModified=JSON.parse(JSON.stringify(d.questions))})}catch(e){console.error(e)}},async submitSurvey(){this.validateFields()&&(console.log(this.questions),console.log(this.questionsTemplateNotModified),JSON.stringify(this.questionsTemplateNotModified)===JSON.stringify(this.questions)?(console.log("No changes"),console.log(this.moduleID),console.log(this.templateID),(await fetch("https://web-i3-back.fly.dev/admin/createfromtemplate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({survey_templateID:this.templateID,moduleID:this.moduleID})})).json().then(e=>{console.log(e)})):(console.log("Changes detected"),console.log(this.questions),(await fetch("https://web-i3-back.fly.dev/admin/createfromnothing",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.templateName,questions:this.questions,moduleID:this.moduleID})})).json().then(e=>{console.log(e)})))}}},P={class:"mb-6"},G={class:"flex justify-between items-center"},H={key:0},K={class:"flex justify-between items-center mb-2"},W={class:"block text-sm font-medium text-gray-700"},X=["onClick"],Y=["onUpdate:modelValue","disabled"],Z=["onUpdate:modelValue","disabled"],ee={key:0};function te(t,e,d,f,l,s){const o=c("searchBarTemplate"),b=c("searchBarModule"),C=c("RadioButton"),I=c("CheckBox");return r(),i("form",null,[n("div",P,[n("div",G,[_(o,{class:"py-2",onTemplateSelected:s.handleTemplateSelected},null,8,["onTemplateSelected"]),_(b,{class:"py-2",onModuleSelected:s.handleModuleSelected},null,8,["onModuleSelected"]),n("button",{onClick:e[0]||(e[0]=(...a)=>s.modifyForm&&s.modifyForm(...a)),class:"ml-4 py-2 px-4 bg-primary font-semibold text-white rounded-md shadow-md hover:bg-primary-hover transition duration-300"}," Modify Form ")]),l.isEditable?(r(),i("div",H,[p(n("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=a=>l.templateName=a),class:"block w-full px-4 py-2 border rounded-md shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 mt-4",placeholder:"Enter Template name"},null,512),[[h,l.templateName]])])):u("",!0)]),(r(!0),i(v,null,x(l.questions,(a,g)=>(r(),i("div",{key:g,class:"mb-4 p-4 border-2 border-dashed border-transparent-hover rounded-lg"},[n("div",K,[n("label",W,"Question "+w(g+1),1),l.isEditable?(r(),i("button",{key:0,onClick:m=>s.removeQuestion(g),class:"text-red-400 hover:text-red-500 transition duration-300"}," Remove ",8,X)):u("",!0)]),n("div",null,[p(n("input",{type:"text","onUpdate:modelValue":m=>a.question_text=m,disabled:!l.isEditable,class:"block w-full px-4 py-2 border rounded-md shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-2",placeholder:"Enter question"},null,8,Y),[[h,a.question_text]])]),e[5]||(e[5]=n("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Response Type",-1)),p(n("select",{"onUpdate:modelValue":m=>a.question_type=m,disabled:!l.isEditable,class:"block w-full px-4 py-2 border rounded-md shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"},e[4]||(e[4]=[n("option",{value:"text"},"Text Input",-1),n("option",{value:"score"},"Star Rating (1-5)",-1),n("option",{value:"radio"},"Radio Buttons",-1),n("option",{value:"checkbox"},"Checkbox",-1)]),8,Z),[[D,a.question_type]]),a.question_type==="radio"?(r(),k(C,{key:0,question:a,isEditable:l.isEditable,onUpdateOptions:s.updateOptions},null,8,["question","isEditable","onUpdateOptions"])):u("",!0),a.question_type==="checkbox"?(r(),k(I,{key:1,question:a,isEditable:l.isEditable,onUpdateOptions:s.updateOptions},null,8,["question","isEditable","onUpdateOptions"])):u("",!0)]))),128)),l.isEditable?(r(),i("div",ee,[n("button",{onClick:e[2]||(e[2]=(...a)=>s.addQuestion&&s.addQuestion(...a)),class:"w-full py-2 px-4 bg-primary font-semibold text-[white] rounded-md shadow-md hover:bg-primary-hover transition duration-300"}," Add Question ")])):u("",!0),n("button",{onClick:e[3]||(e[3]=(...a)=>s.submitSurvey&&s.submitSurvey(...a)),class:"mt-4 w-full py-2 px-4 bg-transparent font-semibold text-[primary] rounded-md shadow-md hover:bg-transparent-hover transition duration-300"}," Publish Survey ")])}const se=y(z,[["render",te]]),oe={components:{CreateSurveyComponent:se}},ne={class:"min-h-screen p-8 flex justify-center items-start"},le={class:"bg-white shadow-md rounded-lg p-6 w-full max-w-3xl"};function re(t,e,d,f,l,s){const o=c("CreateSurveyComponent");return r(),i("div",ne,[n("div",le,[e[0]||(e[0]=n("h1",{class:"text-2xl font-semibold text-[primary] mb-4"},"Create Survey",-1)),_(o)])])}const de=y(oe,[["render",re]]);export{de as default};
