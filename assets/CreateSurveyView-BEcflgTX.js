import{R as D,C as q}from"./CheckBox-DXtLFvpn.js";import{_ as m,o as r,c as d,h as b,v as x,a as l,m as y,g as _,F as k,j as I,n as M,t as w,i as u,r as c,l as v,b as C,k as E}from"./index-D-sF1s1X.js";const N={name:"SelectSearchComponent",props:{options:{type:Array,required:!0},placeholder:{type:String,default:"Select an option"},emptyMessage:{type:String,default:"No results found"}},data(){return{isOpen:!1,search:"",selected:null,highlightedIndex:-1}},computed:{filteredOptions(){return this.options.filter(t=>t.name.toLowerCase().includes(this.search.toLowerCase()))}},methods:{openDropdown(){this.isOpen=!0},closeDropdown(){setTimeout(()=>{this.isOpen=!1},200)},navigate(t){if(!this.isOpen){this.openDropdown();return}const e=this.filteredOptions.length-1;t===1?this.highlightedIndex=this.highlightedIndex<e?this.highlightedIndex+1:0:t===-1&&(this.highlightedIndex=this.highlightedIndex>0?this.highlightedIndex-1:e)},selectOption(t){!this.isOpen||t<0||t>=this.options.length||(this.selected=this.options[t],this.search=this.options[t].name,this.isOpen=!1,this.$emit("option-selected",this.options[t]))}}},j={class:"relative"},$=["placeholder"],B={key:0,class:"absolute z-10 w-full mt-1 px-2 py-2 rounded-md bg-white border border-neutral-300 shadow-sm placeholder-neutral-500"},V={class:"max-h-48 px-1 overflow-y-auto"},F=["onMouseenter","onClick"],U={key:0,class:"px-4 py-2 text-neutral-500"};function Q(t,e,a,h,s,o){return r(),d("div",j,[b(l("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=n=>s.search=n),onFocus:e[1]||(e[1]=(...n)=>o.openDropdown&&o.openDropdown(...n)),onFocusout:e[2]||(e[2]=(...n)=>o.closeDropdown&&o.closeDropdown(...n)),onKeydown:[e[3]||(e[3]=y(_(n=>o.navigate(1),["prevent"]),["down"])),e[4]||(e[4]=y(_(n=>o.navigate(-1),["prevent"]),["up"])),e[5]||(e[5]=y(_(n=>o.selectOption(s.highlightedIndex),["prevent"]),["enter"])),e[6]||(e[6]=y((...n)=>o.closeDropdown&&o.closeDropdown(...n),["esc"]))],placeholder:a.placeholder,class:"w-full px-4 py-2 rounded-md border border-neutral-300 shadow focus:outline-none focus:ring-offset-4 focus:ring-2 focus:ring-efrei-blue-700"},null,40,$),[[x,s.search]]),s.isOpen?(r(),d("div",B,[l("ul",V,[(r(!0),d(k,null,I(o.filteredOptions,(n,p)=>(r(),d("li",{key:p,onMouseenter:f=>s.highlightedIndex=p,onMouseleave:e[7]||(e[7]=f=>s.highlightedIndex=-1),onClick:f=>o.selectOption(p),class:M([{"bg-efrei-blue-50":s.highlightedIndex===p},"px-4 py-2 cursor-pointer rounded-lg break-all"])},w(n.name),43,F))),128)),o.filteredOptions.length===0?(r(),d("li",U,w(a.emptyMessage),1)):u("",!0)])])):u("",!0)])}const O=m(N,[["render",Q]]),R={name:"ModuleSelectSearchComponent",data(){return{modules:[]}},components:{SelectSearchComponent:O},beforeMount(){this.getallModules()},methods:{async getallModules(){try{const e=await(await fetch("https://web-i3-back.fly.dev/admin/modules",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();e.forEach(a=>{a.name=`${a.subject} - ${a.group} - ${a.teacher_lastname}`}),this.modules=e}catch(t){console.error(t)}}}};function A(t,e,a,h,s,o){const n=c("SelectSearchComponent");return r(),v(n,{options:s.modules,placeholder:"Select a module",onOptionSelected:e[0]||(e[0]=p=>this.$emit("module-selected",p))},null,8,["options"])}const J=m(R,[["render",A]]),z={name:"TemplateSelectSearchComponent",data(){return{templates:[]}},components:{SelectSearchComponent:O},beforeMount(){this.getAllTemplates()},methods:{async getAllTemplates(){try{const e=await(await fetch("https://web-i3-back.fly.dev/admin/templates",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();this.templates=e}catch(t){console.error(t)}}}};function L(t,e,a,h,s,o){const n=c("SelectSearchComponent");return r(),v(n,{options:s.templates,placeholder:"Select a template",onOptionSelected:e[0]||(e[0]=p=>this.$emit("template-selected",p))},null,8,["options"])}const P=m(z,[["render",L]]),G={data(){return{modified:!1,isEditable:!0,questionsTemplateNotModified:[],templateID:null,moduleID:null,questions:[],errors:{},templateName:""}},components:{RadioButton:D,CheckBox:q,ModuleSelectSearchComponent:J,TemplateSelectSearchComponent:P},methods:{modifyForm(){this.isEditable=!this.isEditable},addQuestion(){this.questions.push({question_text:"",question_type:"text",options:[]}),console.log(this.questions)},removeQuestion(t){this.questions.splice(t,1)},updateOptions(t,e){t.options=e},validateFields(){this.errors={};let t=!0;return this.questions.forEach(e=>{e.question_type==="text"&&!e.question_text.trim()&&(this.errors[`question_${e.id}`]="Question text is required.",t=!1)}),t},handleTemplateSelected(t){this.isEditable=!1,this.templateID=t.survey_templateID,console.log(t.name,t.survey_templateID),this.getTemplate(t.survey_templateID)},handleModuleSelected(t){console.log(t),this.moduleID=t.moduleID},async getTemplate(t){try{(await fetch(`https://web-i3-back.fly.dev/admin/templates/${t}`)).json().then(a=>{console.log(a),this.questions=a.questions,this.questionsTemplateNotModified=JSON.parse(JSON.stringify(a.questions))})}catch(e){console.error(e)}},async submitSurvey(){this.validateFields()&&(console.log(this.questions),console.log(this.questionsTemplateNotModified),JSON.stringify(this.questionsTemplateNotModified)===JSON.stringify(this.questions)?(console.log("No changes"),console.log(this.moduleID),console.log(this.templateID),(await fetch("https://web-i3-back.fly.dev/admin/createfromtemplate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({survey_templateID:this.templateID,moduleID:this.moduleID})})).json().then(e=>{console.log(e)})):(console.log("Changes detected"),console.log(this.questions),(await fetch("https://web-i3-back.fly.dev/admin/createfromnothing",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.templateName,questions:this.questions,moduleID:this.moduleID})})).json().then(e=>{console.log(e)})))}}},K={class:"mb-6"},H={class:"flex justify-between items-center"},W={key:0},X={class:"flex justify-between items-center mb-2"},Y={class:"block text-sm font-medium text-gray-700"},Z=["onClick"],ee=["onUpdate:modelValue","disabled"],te=["onUpdate:modelValue","disabled"],oe={key:0};function se(t,e,a,h,s,o){const n=c("TemplateSelectSearchComponent"),p=c("ModuleSelectSearchComponent"),f=c("RadioButton"),T=c("CheckBox");return r(),d("form",null,[l("div",K,[l("div",H,[C(n,{class:"py-2",onTemplateSelected:o.handleTemplateSelected},null,8,["onTemplateSelected"]),C(p,{class:"py-2",onModuleSelected:o.handleModuleSelected},null,8,["onModuleSelected"]),l("button",{onClick:e[0]||(e[0]=(...i)=>o.modifyForm&&o.modifyForm(...i)),class:"ml-4 py-2 px-4 bg-primary font-semibold text-white rounded-md shadow-md hover:bg-primary-hover transition duration-300"}," Modify Form ")]),s.isEditable?(r(),d("div",W,[b(l("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=i=>s.templateName=i),class:"block w-full px-4 py-2 border rounded-md shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 mt-4",placeholder:"Enter Template name"},null,512),[[x,s.templateName]])])):u("",!0)]),(r(!0),d(k,null,I(s.questions,(i,S)=>(r(),d("div",{key:S,class:"mb-4 p-4 border-2 border-dashed border-transparent-hover rounded-lg"},[l("div",X,[l("label",Y,"Question "+w(S+1),1),s.isEditable?(r(),d("button",{key:0,onClick:g=>o.removeQuestion(S),class:"text-red-400 hover:text-red-500 transition duration-300"}," Remove ",8,Z)):u("",!0)]),l("div",null,[b(l("input",{type:"text","onUpdate:modelValue":g=>i.question_text=g,disabled:!s.isEditable,class:"block w-full px-4 py-2 border rounded-md shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-2",placeholder:"Enter question"},null,8,ee),[[x,i.question_text]])]),e[5]||(e[5]=l("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Response Type",-1)),b(l("select",{"onUpdate:modelValue":g=>i.question_type=g,disabled:!s.isEditable,class:"block w-full px-4 py-2 border rounded-md shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"},e[4]||(e[4]=[l("option",{value:"text"},"Text Input",-1),l("option",{value:"score"},"Star Rating (1-5)",-1),l("option",{value:"radio"},"Radio Buttons",-1),l("option",{value:"checkbox"},"Checkbox",-1)]),8,te),[[E,i.question_type]]),i.question_type==="radio"?(r(),v(f,{key:0,question:i,isEditable:s.isEditable,onUpdateOptions:o.updateOptions},null,8,["question","isEditable","onUpdateOptions"])):u("",!0),i.question_type==="checkbox"?(r(),v(T,{key:1,question:i,isEditable:s.isEditable,onUpdateOptions:o.updateOptions},null,8,["question","isEditable","onUpdateOptions"])):u("",!0)]))),128)),s.isEditable?(r(),d("div",oe,[l("button",{onClick:e[2]||(e[2]=(...i)=>o.addQuestion&&o.addQuestion(...i)),class:"w-full py-2 px-4 bg-primary font-semibold text-[white] rounded-md shadow-md hover:bg-primary-hover transition duration-300"}," Add Question ")])):u("",!0),l("button",{onClick:e[3]||(e[3]=(...i)=>o.submitSurvey&&o.submitSurvey(...i)),class:"mt-4 w-full py-2 px-4 bg-transparent font-semibold text-[primary] rounded-md shadow-md hover:bg-transparent-hover transition duration-300"}," Publish Survey ")])}const ne=m(G,[["render",se]]),le={components:{CreateSurveyComponent:ne}},ie={class:"p-8 flex justify-center items-start"},re={class:"bg-white shadow-md rounded-lg p-6 w-full max-w-3xl"};function ae(t,e,a,h,s,o){const n=c("CreateSurveyComponent");return r(),d("div",ie,[l("div",re,[e[0]||(e[0]=l("h1",{class:"text-2xl font-semibold text-[primary] mb-4"},"Create Survey",-1)),C(n)])])}const ue=m(le,[["render",ae]]);export{ue as default};
