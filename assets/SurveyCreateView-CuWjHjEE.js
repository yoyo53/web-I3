import{R as q,C as A}from"./CheckboxAnswerComponent-BKii2fmd.js";import{_ as m,o as l,c as d,i as w,v as _,a as r,l as g,h as S,F as I,f as O,n as N,t as v,j as p,u as T,r as c,k as x,b as k,m as E}from"./index-CxCLUZKv.js";const j={name:"SelectSearchComponent",props:{options:{type:Array,required:!0},placeholder:{type:String,default:"Select an option"},emptyMessage:{type:String,default:"No results found"}},data(){return{isOpen:!1,search:"",selected:null,highlightedIndex:-1}},computed:{filteredOptions(){return this.options.filter(t=>t.name.toLowerCase().includes(this.search.toLowerCase()))}},methods:{openDropdown(){this.isOpen=!0},closeDropdown(){setTimeout(()=>{this.isOpen=!1},150)},navigate(t){if(!this.isOpen){this.openDropdown();return}const e=this.filteredOptions.length-1;t===1?this.highlightedIndex=this.highlightedIndex<e?this.highlightedIndex+1:0:t===-1&&(this.highlightedIndex=this.highlightedIndex>0?this.highlightedIndex-1:e)},selectOption(t){!this.isOpen||t<0||t>=this.options.length||(this.selected=this.options[t],this.search=this.options[t].name,this.isOpen=!1,this.$emit("option-selected",this.options[t]))}}},V={class:"relative"},$=["placeholder"],B={key:0,class:"absolute z-10 w-full mt-1 px-2 py-2 rounded-md bg-white border border-neutral-300 shadow-sm placeholder-neutral-400"},Q={class:"max-h-48 px-1 overflow-y-auto"},U=["onMouseenter","onClick"],F={key:0,class:"px-4 py-2 text-neutral-500"};function R(t,e,a,h,n,o){return l(),d("div",V,[w(r("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>n.search=s),onFocus:e[1]||(e[1]=(...s)=>o.openDropdown&&o.openDropdown(...s)),onFocusout:e[2]||(e[2]=(...s)=>o.closeDropdown&&o.closeDropdown(...s)),onKeydown:[e[3]||(e[3]=g(S(s=>o.navigate(1),["prevent"]),["down"])),e[4]||(e[4]=g(S(s=>o.navigate(-1),["prevent"]),["up"])),e[5]||(e[5]=g(S(s=>o.selectOption(n.highlightedIndex),["prevent"]),["enter"])),e[6]||(e[6]=g((...s)=>o.closeDropdown&&o.closeDropdown(...s),["esc"]))],placeholder:a.placeholder,class:"w-full px-4 py-2 rounded-md border border-neutral-300 shadow focus:outline-none focus:ring-offset-4 focus:ring-2 focus:ring-efrei-blue-700"},null,40,$),[[_,n.search]]),n.isOpen?(l(),d("div",B,[r("ul",Q,[(l(!0),d(I,null,O(o.filteredOptions,(s,u)=>(l(),d("li",{key:u,onMouseenter:f=>n.highlightedIndex=u,onMouseleave:e[7]||(e[7]=f=>n.highlightedIndex=-1),onClick:f=>o.selectOption(u),class:N([{"bg-efrei-blue-50":n.highlightedIndex===u},"px-4 py-2 cursor-pointer rounded-lg break-all"])},v(s.name),43,U))),128)),o.filteredOptions.length===0?(l(),d("li",F,v(a.emptyMessage),1)):p("",!0)])])):p("",!0)])}const D=m(j,[["render",R]]),z=T(),J={name:"SelectSearchTemplateComponent",data(){return{templates:[]}},components:{SelectSearchComponent:D},methods:{async getAllTemplates(){try{const t=await fetch("https://web-i3-back.fly.dev/admin/templates",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error(t.statusText);this.templates=await t.json()}catch(t){console.error(t),z.error("Something went wrong")}}},beforeMount(){this.getAllTemplates()}};function G(t,e,a,h,n,o){const s=c("SelectSearchComponent");return l(),x(s,{options:n.templates,placeholder:"Select a template",onOptionSelected:e[0]||(e[0]=u=>this.$emit("template-selected",u))},null,8,["options"])}const L=m(J,[["render",G]]),P=T(),K={name:"SelectSearchModuleComponent",data(){return{modules:[]}},components:{SelectSearchComponent:D},methods:{async getallModules(){try{const t=await fetch("https://web-i3-back.fly.dev/admin/modules",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error(t.statusText);const e=await t.json();e.forEach(a=>{a.name=`${a.subject} - ${a.group} - ${a.teacher.lastname}`}),this.modules=e}catch(t){console.error(t),P.error("Something went wrong")}}},beforeMount(){this.getallModules()}};function H(t,e,a,h,n,o){const s=c("SelectSearchComponent");return l(),x(s,{options:n.modules,placeholder:"Select a module",onOptionSelected:e[0]||(e[0]=u=>this.$emit("module-selected",u))},null,8,["options"])}const W=m(K,[["render",H]]),y=T(),X={name:"SurveyCreateComponent",data(){return{editable:!1,templateID:null,moduleID:null,templateName:"",templateQuestions:[],questions:[]}},components:{RadioAnswerComponent:q,CheckboxAnswerComponent:A,SelectSearchModuleComponent:W,SelectSearchTemplateComponent:L},methods:{modifyForm(){this.editable=!this.editable},addQuestion(){this.questions.push({question_text:"",question_type:"text",options:[]})},removeQuestion(t){this.questions.splice(t,1)},updateOptions(t,e){t.options=e},handleTemplateSelected(t){this.editable=!1,this.templateID=t.templateID,this.getTemplate(t.templateID)},handleModuleSelected(t){this.moduleID=t.moduleID},async getTemplate(t){try{const e=await fetch("https://web-i3-back.fly.dev/admin/templates/"+t,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.ok)throw new Error(e.statusText);const a=await e.json();this.questions=a.questions,this.templateQuestions=JSON.parse(JSON.stringify(a.questions))}catch(e){console.error(e),y.error("Something went wrong")}},async postSurvey(){try{if(JSON.stringify(this.templateQuestions)===JSON.stringify(this.questions)){const t=await fetch("https://web-i3-back.fly.dev/admin/surveys/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({templateID:this.templateID,moduleID:this.moduleID})});if(!t.ok)throw new Error(t.statusText);y.success("Survey created successfully"),this.$router.push({name:"admin"})}else{const t=await fetch("https://web-i3-back.fly.dev/admin/surveys/create/custom",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({name:this.templateName,questions:this.questions,moduleID:this.moduleID})});if(!t.ok)throw new Error(t.statusText);y.success("Survey created successfully"),this.$router.push({name:"admin"})}}catch(t){console.error(t),y.error("Something went wrong")}}}},Y={class:"p-6 max-w-3xl rounded-lg shadow-md mx-auto"},Z={class:"mb-6"},ee={class:"flex flex-wrap justify-between items-center gap-4"},te={key:0},oe={class:"flex text-sm justify-between items-center mb-2"},ne={class:"block"},se=["onClick"],re=["onUpdate:modelValue","disabled"],le=["onUpdate:modelValue","disabled"];function ie(t,e,a,h,n,o){const s=c("SelectSearchTemplateComponent"),u=c("SelectSearchModuleComponent"),f=c("RadioAnswerComponent"),M=c("CheckboxAnswerComponent");return l(),d("div",Y,[r("form",{onSubmit:e[3]||(e[3]=S((...i)=>o.postSurvey&&o.postSurvey(...i),["prevent"]))},[r("div",Z,[r("div",ee,[k(s,{class:"grow",onTemplateSelected:o.handleTemplateSelected},null,8,["onTemplateSelected"]),k(u,{class:"grow",onModuleSelected:o.handleModuleSelected},null,8,["onModuleSelected"]),n.templateID?(l(),d("button",{key:0,type:"button",onClick:e[0]||(e[0]=(...i)=>o.modifyForm&&o.modifyForm(...i)),class:"grow py-2 px-4 bg-efrei-blue-500 font-semibold text-white rounded-md shadow-md hover:bg-efrei-blue-950 focus:outline-none focus:ring-offset-2 focus:ring-2 focus:ring-efrei-blue-700"},v(n.editable?"Cancel":"Edit Form"),1)):p("",!0)]),n.editable?(l(),d("div",te,[e[4]||(e[4]=r("label",{for:"template-name",class:"block mb-2 text-sm"}," Template Name ",-1)),w(r("input",{type:"text",id:"template-name","onUpdate:modelValue":e[1]||(e[1]=i=>n.templateName=i),required:"",class:"block w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-offset-2 focus:ring-2 focus:ring-efrei-blue-700",placeholder:"Enter template name"},null,512),[[_,n.templateName]])])):p("",!0)]),(l(!0),d(I,null,O(n.questions,(i,C)=>(l(),d("div",{key:C,class:"mb-4 p-4 border-2 border-dashed border-neutral-200 rounded-lg"},[r("div",oe,[r("label",ne,"Question "+v(C+1),1),n.editable?(l(),d("button",{key:0,type:"button",onClick:b=>o.removeQuestion(C),class:"text-red-400 hover:text-red-500 font-semibold rounded-lg focus:outline-none focus:ring-offset-4 focus:ring-2 focus:ring-red-700"}," Remove ",8,se)):p("",!0)]),w(r("input",{type:"text","onUpdate:modelValue":b=>i.question_text=b,disabled:!n.editable,required:"",class:"block w-full mb-2 px-4 py-2 border border-neutral-300 rounded-md shadow-sm focus:outline-none focus:ring-offset-2 focus:ring-2 focus:ring-efrei-blue-700",placeholder:"Enter question"},null,8,re),[[_,i.question_text]]),e[6]||(e[6]=r("label",{class:"block text-sm mb-2"},"Response Type",-1)),w(r("select",{"onUpdate:modelValue":b=>i.question_type=b,disabled:!n.editable,required:"",class:"block w-full px-4 py-2 bg-transparent border border-neutral-300 rounded-md focus:outline-none focus:ring-offset-2 focus:ring-2 focus:ring-efrei-blue-700 disabled:bg-neutral-100"},e[5]||(e[5]=[r("option",{value:"text"},"Text Input",-1),r("option",{value:"score"},"Star Rating (1-5)",-1),r("option",{value:"radio"},"Radio Buttons",-1),r("option",{value:"checkbox"},"Checkbox",-1)]),8,le),[[E,i.question_type]]),i.question_type==="radio"?(l(),x(f,{key:0,question:i,editable:n.editable,answerable:!1,onUpdateOptions:o.updateOptions,class:"my-4"},null,8,["question","editable","onUpdateOptions"])):p("",!0),i.question_type==="checkbox"?(l(),x(M,{key:1,question:i,editable:n.editable,answerable:!1,onUpdateOptions:o.updateOptions,class:"my-4"},null,8,["question","editable","onUpdateOptions"])):p("",!0)]))),128)),n.editable?(l(),d("button",{key:0,type:"button",onClick:e[2]||(e[2]=(...i)=>o.addQuestion&&o.addQuestion(...i)),class:"w-full py-2 px-4 bg-efrei-blue-500 font-semibold text-white rounded-md shadow-md hover:bg-efrei-blue-950 focus:outline-none focus:ring-offset-2 focus:ring-2 focus:ring-efrei-blue-700"}," Add Question ")):p("",!0),e[7]||(e[7]=r("button",{type:"submit",class:"mt-4 w-full py-2 px-4 bg-efrei-blue-100 font-semibold rounded-md hover:bg-efrei-blue-200 focus:outline-none focus:ring-offset-2 focus:ring-2 focus:ring-efrei-blue-700"}," Publish Survey ",-1))],32)])}const ae=m(X,[["render",ie]]),de={name:"SurveyCreateView",components:{SurveyCreateComponent:ae}},ue={class:"my-6"};function pe(t,e,a,h,n,o){const s=c("SurveyCreateComponent");return l(),d("div",null,[r("section",ue,[e[0]||(e[0]=r("h1",{class:"my-6 text-center text-2xl font-semibold"},"Create Survey",-1)),k(s)])])}const he=m(de,[["render",pe]]);export{he as default};
